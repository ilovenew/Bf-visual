-- Roblox Warning GUI Script
local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer
local TweenService = game:GetService("TweenService")
local TextChatService = game:GetService("TextChatService")
local StarterGui = game:GetService("StarterGui")

local screenGui = Instance.new("ScreenGui")
screenGui.Name = "WarningGui"
screenGui.Parent = game.CoreGui
screenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling

local mainFrame = Instance.new("Frame")
mainFrame.Name = "WarningFrame"
mainFrame.Size = UDim2.new(0.4, 0, 0.15, 0)
mainFrame.Position = UDim2.new(0.3, 0, 0.85, 0)
mainFrame.AnchorPoint = Vector2.new(0, 0.5)
mainFrame.BackgroundColor3 = Color3.fromRGB(45, 45, 45)
mainFrame.BorderSizePixel = 2
mainFrame.BorderColor3 = Color3.fromRGB(255, 0, 0)
mainFrame.ClipsDescendants = true
mainFrame.Parent = screenGui
mainFrame.Visible = false

local corner = Instance.new("UICorner")
corner.CornerRadius = UDim.new(0, 8)
corner.Parent = mainFrame

local stroke = Instance.new("UIStroke")
stroke.Color = Color3.fromRGB(255, 50, 50)
stroke.Thickness = 3
stroke.Parent = mainFrame

local warningLabel = Instance.new("TextLabel")
warningLabel.Name = "WarningText"
warningLabel.Size = UDim2.new(0.9, 0, 0.7, 0)
warningLabel.Position = UDim2.new(0.05, 0, 0.15, 0)
warningLabel.BackgroundTransparency = 1
warningLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
warningLabel.TextScaled = true
warningLabel.Font = Enum.Font.GothamBold
warningLabel.Text = "WARNING MESSAGE"
warningLabel.TextWrapped = true
warningLabel.Parent = mainFrame

local icon = Instance.new("ImageLabel")
icon.Name = "WarningIcon"
icon.Size = UDim2.new(0, 30, 0, 30)
icon.Position = UDim2.new(0.02, 0, 0.55, 0)
icon.AnchorPoint = Vector2.new(0, 0.5)
icon.BackgroundTransparency = 1
icon.Image = "rbxassetid://7733765394"
icon.Parent = mainFrame

-- Function to show warning
local function showWarning(message, duration)
    if not message or #message == 0 then
        return
    end
    
    mainFrame.Visible = true
    mainFrame.Size = UDim2.new(0, 0, 0.15, 0)
    mainFrame.Position = UDim2.new(0.5, 0, 0.85, 0)
    
    warningLabel.Text = message
    
    local openTween = TweenService:Create(
        mainFrame,
        TweenInfo.new(0.5, Enum.EasingStyle.Quad, Enum.EasingDirection.Out),
        {Size = UDim2.new(0.4, 0, 0.15, 0)}
    )
    
    openTween:Play()
    
    task.wait(duration or 6)
    
    local closeTween = TweenService:Create(
        mainFrame,
        TweenInfo.new(0.5, Enum.EasingStyle.Quad, Enum.EasingDirection.Out),
        {Size = UDim2.new(0, 0, 0.15, 0)}
    )
    
    closeTween:Play()
    closeTween.Completed:Connect(function()
        mainFrame.Visible = false
    end)
end

-- Function to process chat commands
local function processChatCommand(message)
    local lowerMessage = message:lower()
    
    if string.sub(lowerMessage, 1, 6) == "!warn " then
        local targetMessage = string.sub(message, 7)
        if #targetMessage > 0 then
            showWarning(targetMessage, 6)
            return true
        end
    elseif lowerMessage == "!owarn" then
        showWarning("PLS DON'T CLICK ! FOR NO REASON PLS BE PATIENT AND BYPASS ALMOST FINISHED ðŸ«¡", 6)
        return true
    end
    
    return false
end

-- Handle legacy chat system
local function handleLegacyChat()
    LocalPlayer.Chatted:Connect(function(message)
        processChatCommand(message)
    end)
end

-- Handle new text chat system
local function handleTextChat()
    if not TextChatService then return end
    
    -- Listen for messages in all channels
    for _, channel in ipairs(TextChatService:GetChildren()) do
        if channel:IsA("TextChannel") then
            local originalFunction = channel.OnIncomingMessage
            channel.OnIncomingMessage = function(message)
                if message.TextSource then
                    local player = Players:GetPlayerByUserId(message.TextSource.UserId)
                    if player and player == LocalPlayer then
                        local isCommand = processChatCommand(message.Text)
                        if isCommand then
                            -- Return nil to hide the command from chat
                            return nil
                        end
                    end
                end
                return originalFunction and originalFunction(message) or message
            end
        end
    end
    
    -- Also handle command registration for the new chat system
    local function registerTextChatCommands()
        local textChatCommands = TextChatService:FindFirstChild("TextChatCommands")
        if not textChatCommands then
            textChatCommands = Instance.new("Folder")
            textChatCommands.Name = "TextChatCommands"
            textChatCommands.Parent = TextChatService
        end
        
        -- Register !warn command - FIXED: Now properly extracts just the message
        local warnCommand = Instance.new("TextChatCommand")
        warnCommand.Name = "WarnCommand"
        warnCommand.PrimaryAlias = "!warn"
        warnCommand.SecondaryAlias = "/warn"
        warnCommand.Parent = textChatCommands
        
        warnCommand.Triggered:Connect(function(source, fullMessage)
            -- Extract just the message part (remove the command)
            local message = string.sub(fullMessage, 7) -- Remove "!warn " prefix
            if #message > 0 then
                showWarning(message, 6)
            else
                showWarning("Please provide a warning message after !warn", 4)
            end
        end)
        
        -- Register !owarn command
        local owarnCommand = Instance.new("TextChatCommand")
        owarnCommand.Name = "OWarnCommand"
        owarnCommand.PrimaryAlias = "!owarn"
        owarnCommand.SecondaryAlias = "/owarn"
        owarnCommand.Parent = textChatCommands
        
        owarnCommand.Triggered:Connect(function()
            showWarning("PLS DON'T CLICK ! FOR NO REASON PLS BE PATIENT AND BYPASS ALMOST FINISHED ðŸ«¡", 6)
        end)
    end
    
    -- Try to register commands, but don't break if we can't
    pcall(registerTextChatCommands)
end

-- Handle both chat systems
handleLegacyChat()
if TextChatService then
    handleTextChat()
end

-- Show initial message
showWarning("DR!X SCRIPT LOADED! CLICK ON THE BYPASS BUTTON TO LOAD SCRIPT", 4)

print("Warning GUI Script Loaded Successfully!")
print("Commands:")
print("!warn [message] - Show custom warning")
print("!owarn - Show default warning")
